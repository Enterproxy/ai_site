"use strict";(()=>{var e={};e.id=903,e.ids=[903],e.modules={932:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>f,default:()=>p});var n=t(7313),o=t(4652),i=t.n(o),s=t(3873),u=t.n(s),l=t(4593),d=e([n]);n=(d.then?(await d)():d)[0];let f={api:{bodyParser:!1}},P=u().join(process.cwd(),"public","uploads"),m=u().join(process.cwd(),"public","thumbnails");async function c(){await i().ensureDir(P),await i().ensureDir(m)}async function p(e,r){if(await c(),"GET"===e.method)try{let e=await l.z.document.findMany({orderBy:{date:"desc"}});return r.status(200).json(e)}catch(e){return console.error("GET error:",e),r.status(500).json({error:"Server error (GET)"})}if("POST"===e.method){let t,a;try{({fields:t,files:a}=await new Promise((r,t)=>{new n.IncomingForm({uploadDir:P,keepExtensions:!0,maxFileSize:0x3200000}).parse(e,(e,a,n)=>e?t(e):r({fields:a,files:n}))}))}catch(e){return console.error("Parse error:",e),r.status(500).json({error:"Upload parsing error"})}try{let e=a.file,n=Array.isArray(e)?e[0]:e;if(!n?.filepath)return r.status(400).json({error:"No PDF uploaded"});let o=u().basename(n.filepath),i=`/uploads/${o}`,s=a.thumbnail,d=Array.isArray(s)?s[0]:s;if(!d?.filepath)return r.status(400).json({error:"No thumbnail uploaded"});let c=u().basename(d.filepath),p=`/thumbnails/${c}`,f=await l.z.document.create({data:{title:String(t.title||o),author:String(t.author||""),date:t.date?new Date(String(t.date)):new Date,language:String(t.language||""),tags:t.tags?JSON.parse(String(t.tags)):[],keywords:t.keywords?JSON.parse(String(t.keywords)):[],content:String(t.content||""),fileUrl:i,thumbnailUrl:p}});return r.status(201).json(f)}catch(e){return console.error("POST error:",e),r.status(500).json({error:"Server error (POST)"})}}return r.setHeader("Allow",["GET","POST"]),r.status(405).end(`Method ${e.method} Not Allowed`)}a()}catch(e){a(e)}})},3480:(e,r,t)=>{e.exports=t(5600)},3873:e=>{e.exports=require("path")},4593:(e,r,t)=>{t.d(r,{z:()=>n});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["query"]})},4652:e=>{e.exports=require("fs-extra")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},7313:e=>{e.exports=import("formidable")},8113:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>l,routeModule:()=>c});var n=t(3480),o=t(8667),i=t(6435),s=t(932),u=e([s]);s=(u.then?(await u)():u)[0];let l=(0,i.M)(s,"default"),d=(0,i.M)(s,"config"),c=new n.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/documents",pathname:"/api/documents",bundlePath:"",filename:""},userland:s});a()}catch(e){a(e)}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=8113);module.exports=t})();